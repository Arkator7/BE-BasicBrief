<!DOCTYPE html>
<html>
	<head>

	<p id="output">

		<meta charset="utf-8">
		
		<title>List of Suburb with Postcode</title>
		
		<!-- Currently unused, will integrate this later -->
		<!--<script type="text/javascript" src="tree.js"></script>-->
		<!--<script type="text/javascript" src="queue.js"></script>-->
		
		<!-- D3 js -->
		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>

		<style>
			<!--font-->
			body {font-family: monospace; line-height: 160%; font-size: 18px; }
			ul {list-style: none; margin: 0; padding: 0;}
			
			li {display: inline-block; min-width: 80px; padding: 10px; background-color: #eee; margin: 0;}
			<!--input box-->
			input {border: 2px dotted #ccc; background: white; font-family: monospace; padding: 10px 20px; font-size: 18px; margin: 20px 10px 20px 0; color: black;}
			<!--input box when selected for input background-->
			input:focus { background-color: white; outline: none;}
		</style>
		
	</head>

	<body>
		<div id="viz"></div>

		<p><b>Enter Postcode (and press Enter):</b></p>
		<form name="myform" onSubmit="return handleClick()">
			<input type="text" id="myVal" placeholder="Postcode&hellip;">
		</form>

		<script type="text/javascript">
			var websersrc = "/materials/Australian_Post_Codes_Lat_Lon.csv";
						
			//Records input
            function handleClick(event){
                //console.log(document.getElementById("myVal").value)
                draw(document.getElementById("myVal").value)
                return false;
            }
 
			//Draw resulting table 
            function draw(val){
				var x = getPC(val);

				//console.log("x", x);
            }

			//Using D3 to read csv file and extract data
			function getPC (pc) {
				resultLib = [];
				d3.csv(websersrc, function(postcode) {
					//console.log("postcode", postcode)
			
					data = postcode.map(function(d) {
						//each d is one line of the csv file represented as a json object
						//console.log("d", d)

						pcode = d.postcode;
						suburb = d.suburb;
						state = d.state;
						dc = d.dc;
						dc_type = d.type;
						lat = d.lat;
						lon = d.lon;
					
						if (pcode == pc) {
							resultLib.push(d);
						}
					
						return {"postcode": postcode,
								"suburb": suburb,
								"state": state,
								"dc": dc,
								"dc_type": dc_type,
								"lat": lat,
								"lon": lon} ;
					})
					//console.log("data", data)

					//Draw table
					d3.json('materials/return.json', function (error,data) {
						function tabulate(data, columns) {
							d3.select('body').select('table').remove();
						
							var table = d3.select('body').append('table');
							var thead = table.append('thead');
							var tbody = table.append('tbody');

							// append the header row
							thead.append('tr')
							  .selectAll('th')
							  .data(columns).enter()
							  .append('th')
								.text(function (column) { return column; });

							// create a row for each object in the data
							var rows = tbody.selectAll('tr')
							  .data(data)
							  .enter()
							  .append('tr');

							// create a cell in each row for each column
							var cells = rows.selectAll('td')
										.data(function (row) {
									return columns.map(function (column) {
									return {column: column, value: row[column]};
								});
							})
								.enter()
								.append('td')
								.text(function (d) { return d.value; });

							return table;
						}

						// render the table(s)
						tabulate(resultLib, ['postcode',
											'suburb',
											'state',
											'dc',
											'dc_type',
											'lat',
											'lon']);
					});
				});
			};
		</script>
	</body>
</http>