<!DOCTYPE html>
<html>
	<head>

	<p id="output">

		<meta charset="utf-8">
		<title>Input text with D3</title> <!-- adapted from http://javadude.wordpress.com/2012/05/17/d3-js-with-dynamic-data/ -->
		<script type="text/javascript" src="tree.js"></script>
		<script type="text/javascript" src="queue.js"></script>

		<script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
		<!--<script type="text/javascript" src="http://mbostock.github.com/d3/d3.csv.js"></script>-->

		<!--<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/d3/3.4.2/d3.js"></script>-->

		<style>
			body {font-family: monospace; line-height: 160%; font-size: 18px; }
			ul {list-style: none; margin: 0; padding: 0;}
			li {display: inline-block; min-width: 80px; padding: 10px; background-color: #eee; margin: 0;}
			input {border: 1px dotted #ccc; background: white; font-family: monospace; padding: 10px 20px; font-size: 18px; margin: 20px 10px 20px 0; color: red;}
			input:focus { background-color:yellow; outline: none;}
		</style>
		
	</head>

	<body>

		<div id="viz"></div>

		<form name="myform" onSubmit="return handleClick()">
			<input type="text" id="myVal" placeholder="Postcode&hellip;">
		</form>

		<ul></ul>

		<script type="text/javascript">
			var websersrc = "http://127.0.0.1:8887/materials/Australian_Post_Codes_Lat_Lon.csv";

			var lib = [];
			var resultLib = [];
			
			function getPC (pc) {
				resultLib = [];
				d3.csv(websersrc, function(postcode) {
					//console.log("postcode", postcode)
			
					data = postcode.map(function(d) {
						//each d is one line of the csv file represented as a json object
						//console.log("d", d)

						pcode = d.postcode;
						suburb = d.suburb;
						state = d.state;
						dc = d.dc;
						dc_type = d.type;
						lat = d.lat;
						lon = d.lon;
					
						if (pcode == pc) {
							resultLib.push(d);
						}
					
						return {"postcode": postcode,
								"suburb": suburb,
								"state": state,
								"dc": dc,
								"dc_type": dc_type,
								"lat": lat,
								"lon": lon} ;
					})
					//console.log("data", data)
					lib = data;

					d3.json('material/return.json', function (error,data) {
						function tabulate(data, columns) {
							d3.select('body').select('table').remove();
						
							var table = d3.select('body').append('table');
							var thead = table.append('thead');
							var tbody = table.append('tbody');

							// append the header row
							thead.append('tr')
							  .selectAll('th')
							  .data(columns).enter()
							  .append('th')
								.text(function (column) { return column; });

							// create a row for each object in the data
							var rows = tbody.selectAll('tr')
							  .data(data)
							  .enter()
							  .append('tr');

							// create a cell in each row for each column
							var cells = rows.selectAll('td')
										.data(function (row) {
									return columns.map(function (column) {
									return {column: column, value: row[column]};
								});
							})
								.enter()
								.append('td')
								.text(function (d) { return d.value; });

							return table;
						}

						// render the table(s)
						tabulate(resultLib, ['postcode',
											'suburb',
											'state',
											'dc',
											'dc_type',
											'lat',
											'lon']);
					});
				
					return resultLib;
				});
			};
			
            var dataset = [];
 
             function handleClick(event){
                //console.log(document.getElementById("myVal").value)
                draw(document.getElementById("myVal").value)
                return false;
            }
 
             function draw(val){
				var x = getPC(val);

				console.log("x", x);
            }
		</script>
	</body>
</http>